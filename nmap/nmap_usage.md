# Nmap Cheat Sheet

## üìå All-in-one Service Detection

<details>
<summary><strong>Commands for Service Detection</strong></summary>

- `nmap -sV` : Service scan (Service/version info)
- `nmap -sV -F` : Service scan + The most common 100 ports
- `nmap -sV --top-ports 100` : Service scan + Top 100 ports
- `nmap -sV -A` : Service scan + Aggressive mode (Essential Scripts)
- `nmap -sV 192.168.1.0/24` : Service scan + All Devices on Network
- `nmap -sV -p-` : Service scan + 65535 possible ports
- `nmap -sV -p 80,443,8080` : Service scan + Specific Port Discovery
- `nmap -sV -A -p-` : Service scan + Aggressive Mode (Essential Scripts) + 65535 possible ports
- `nmap -sV -T4` : Service scan + Fast and Light scan
- `nmap -sV -O` : Service scan + OS Detection
- `nmap -sV -sC` : Service scan + Default Scripts
- `nmap -sV -sU` : Service scan + UDP Scan
- `nmap -sV -T3 -oN scan_results.txt` : Service scan + Timing + Output direction
- `nmap -sV --traceroute` : Service scan + Traceroute utility

</details>

## üìå Live Host Discovery

<details>
<summary><strong>ARP - TCP/IP Link Layer üåê</strong></summary>

- ARP scan usually requires privileged user access.
- `sudo nmap -PR -sn IP_ADDRESS/24` : ARP scan with privileged access
- `arp-scan` provides customization of your scan.
- Installation: `apt install arp-scan`
- Examples:
  - `sudo arp-scan -l/--localnet IP_ADDRESS/24`
  - `sudo arp-scan -I eth0/tun0 -l IP_ADDRESS/24`
  - `sudo arp-scan IP_ADDRESS/24`
- Same approach with nmap: `sudo nmap -PR -sn IP_ADDRESS/24`

</details>

<details>
<summary><strong>ICMP - OSI Network Layer (5) üåê</strong></summary>

- You can ping every IP address on the network using ICMP.
- ICMP echo request discovery: `nmap -PE -sn MACHINE_IP/24`
- ICMP Timestamp Usage (-PP): `nmap -PP -sn IP_ADDRESS/24`
- ICMP Address Mask Usage (-PM): `nmap -PM -sn IP_ADDRESS/24`

</details>

<details>
<summary><strong>TCP - OSI Transport Layer (4) üåê</strong></summary>

- TCP SYN Ping (-PS): `nmap -PS80,443 -sn IP_ADDRESS`
- TCP ACK Ping (-PA): `nmap -PA21,23,49,8080 -sn IP_ADDRESS`
- UDP Ping: `nmap -PU -sn IP_ADDRESS/24`

</details>

<details>
<summary><strong>Masscan Tool</strong></summary>

- Uses a similar approach to discover live hosts.
- Installation: `apt install masscan`
- Examples:
  - Subnet + Specific Port: `masscan IP_ADDRESS/24 -p443`
  - Specific Port: `masscan IP_ADDRESS -p80`
  - Specific Ports: `masscan IP_ADDRESS -p8080,80,443`
  - Range: `masscan IP_ADDRESS -p21-25`
  - Top Known 100 Ports: `masscan IP_ADDRESS --top-ports 100`

</details>

</details>

## üìå Basic Port Scans

<details>
<summary><strong>TCP Connect Scan</strong></summary>

- A TCP connect scan, also known as a "full connect scan," is used to determine the status of ports on a target host.
- `nmap -sT IP_ADDRESS` : TCP connect scan

</details>

<details>
<summary><strong>TCP SYN Scan</strong></summary>

- A TCP SYN scan, also known as a "half-open scan," is another popular technique for network port scanning.
- `nmap -sS IP_ADDRESS` : TCP SYN scan

</details>

<details>
<summary><strong>UDP Scan</strong></summary>

- UDP scanning is used to identify open UDP ports on a target system or network.
- `nmap -sU IP_ADDRESS` : UDP scan

</details>

<details>
<summary><strong>Scaling, Scope, and Performance</strong></summary>

- Specifying Ports:
  - Port List: `-p22,23,443`
  - Port Range: `-p21-1020`
  - Full Ports: `-p-`
  - Most common 100 ports: `-F` or `--top-ports 100`
- Scan Time Control:
  - Use `-T` option to determine the speed of the scan operation.
- Example: `-T4` for a fast scan
- Other options:
  - `paranoid (0)`
  - `sneaky (1)`
  - `polite (2)`
  - `normal (3)`
  - `aggressive (4)`
  - `insane (5)`

</details>

## Extra Information on Parameters

<details>
<summary><strong>üìå "-A" Parameter</strong></summary>

- Known as Aggressive Mode.
- Fast Scan using `-T4`
- Auto OS detection `-O`
- Service Detection `-sV`
- Pingless Scanning `-Pn`
- Most common 100 ports `-F`
- Traceroute between host and target `--traceroute`
- NSE Scripting utility `-sC`

</details>

<details>
<summary><strong>üìå "-Pn" Parameter</strong></summary>

- Bypasses noisy ICMP probes.
- Better assessment of network defenses.
- Enables gathering information without alerting defenders.
- Ethical consideration: Use with proper authorization.

</details>

<details>
<summary><strong>üìå Bypassing Firewall</strong></summary>

- TCP FIN, NULL, and Xmas Scans
- Null scan (-sN)
- FIN scan (-sF)
- Xmas scan (-sX)
- Idle Scan (-sI)
- Fragmentation (-f) and Randomize Scan Delay (--randomize-hosts)
- MAC Spoofing (--spoof-mac)
- Using Proxy Chains
- Timing and Rate Control (-T and --scan-delay)
- ACK Flag Probe (-PA, -PU, -PY)
- Maimon Scan (FIN/ACK -sM)
- Randomize Source Ports (-r ports consecutively --randomize-hosts)
- Source IP Spoofing (-S SRC_IP_ADDR)

</details>

<details>
<summary><strong>üìå Nmap Scripting Engine (NSE)</strong></summary>

- Allows users to write (and share) simple scripts (using the Lua programming language) to automate a wide variety of tasks.
- Scripting example: `nmap -p 80 --script=http-title IP_ADDRESS`

</details>

## üìå Output Formats

<details>
<summary><strong>Text Output</strong></summary>

- `-oN` : Normal output
- `-oG` : Grepable output
- `-oX` : XML output
- `-oA` : All formats (normal, grepable, XML)

</details>

<details>
<summary><strong>Common Output Commands</strong></summary>

- `nmap -oN scan_results.txt` : Save results to a text file
- `nmap -oG grepable_results.txt` : Save results in grepable format
- `nmap -oX xml_results.xml` : Save results in XML format
- `nmap -oA all_results IP_ADDRESS` : Save results in all formats

</details>

<details>
<summary><strong>üìå Nmap Scripting Engine (NSE)</strong></summary>

- Default nmap script path: `/usr/share/nmap/scripts`

- For the **DEFAULT** scripts: `--script=default` or `-sC`
  - `sudo nmap -sS` (*Stealthy Scan*) `-sC MACHINE_IP` (*Less noisy*)
  - `sudo nmap -sV` (*Service Scan*) `-sC MACHINE_IP` (*Noisy*)  

# Script Table

| Script Category | Description                                                |
|-----------------|------------------------------------------------------------|
| auth            | Authentication related scripts                            |
| broadcast       | Discover hosts by sending broadcast messages              |
| brute           | Performs brute-force password auditing against logins      |
| default         | Default scripts, same as -sC                              |
| discovery       | Retrieve accessible information, such as database tables and DNS names |
| dos             | Detects servers vulnerable to Denial of Service (DoS)      |
| exploit         | Attempts to exploit various vulnerable services           |
| external        | Checks using a third-party service, such as Geoplugin and Virustotal |
| fuzzer          | Launch fuzzing attacks                                     |
| intrusive       | Intrusive scripts such as brute-force attacks and exploitation |
| malware         | Scans for backdoors                                       |
| safe            | Safe scripts that won‚Äôt crash the target                   |
| version         | Retrieve service versions                                  |
| vuln            | Checks for vulnerabilities or exploit vulnerable services |

## Script Usage
- Listing scripts *nmap --script-help "service_or_ability *"*
- nmap --script-help "ssh*"
- sudo nmap -sS -n --script "script_name" MACHINE_IP

## Summary

| Option              | Meaning                                  |
|---------------------|------------------------------------------|
| -sV                 | Determine service/version info on open ports |
| -sV --version-light | Try the most likely probes (2)            |
| -sV --version-all   | Try all available probes (9)              |
| -O                  | Detect OS                                |
| --traceroute        | Run traceroute to target                  |
| --script=SCRIPTS    | Nmap scripts to run                       |
| -sC or --script=default | Run default scripts                  |
| -A                  | Equivalent to -sV -O -sC --traceroute    |
| -oN                 | Save output in normal format              |
| -oG                 | Save output in grepable format            |
| -oX                 | Save output in XML format                 |
| -oA                 | Save output in normal, XML, and Grepable formats |

</details>

<details>
<summary><strong>üìå Protocols & Servers</strong></summary>

## Telnet
- The Telnet protocol is an application layer protocol used to connect to a virtual terminal of another computer. Using Telnet, a user can log into another computer and access its terminal (console) to run programs, start batch processes, and perform system administration tasks remotely.

## Hypertext Transfer Protocol (HTTP)
- Hypertext Transfer Protocol (HTTP) is the protocol used to transfer web pages. Your web browser connects to the webserver and uses HTTP to request HTML pages and images among other files and submit forms and upload various files. Anytime you browse the World Wide Web (WWW), you are certainly using the HTTP protocol.

## File Transfer Protocol (FTP)
- File Transfer Protocol (FTP) was developed to make the transfer of files between different computers with different systems efficient.

## Simple Mail Transfer Protocol (SMTP)
- Email is one of the most used services on the Internet. There are various configurations for email servers; for instance, you may set up an email system to allow local users to exchange emails with each other with no access to the Internet. However, we will consider the more general setup where different email servers connect over the Internet.

  Email delivery over the Internet requires the following components:
  1. Mail Submission Agent (MSA)
  2. Mail Transfer Agent (MTA)
  3. Mail Delivery Agent (MDA)
  4. Mail User Agent (MUA)

## Post Office Protocol 3 (POP3)
- Post Office Protocol version 3 (POP3) is a protocol used to download the email messages from a Mail Delivery Agent (MDA) server, as shown in the figure below. The mail client connects to the POP3 server, authenticates, downloads the new email messages before (optionally) deleting them.

## Internet Message Access Protocol (IMAP)
- Internet Message Access Protocol (IMAP) is more sophisticated than POP3. IMAP makes it possible to keep your email synchronized across multiple devices (and mail clients). In other words, if you mark an email message as read when checking your email on your smartphone, the change will be saved on the IMAP server (MDA) and replicated on your laptop when you synchronize your inbox.

</details>

