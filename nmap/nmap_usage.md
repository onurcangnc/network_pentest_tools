Nmap Cheat Sheet
================

<details>
<summary><strong>üìå All in one Service Detection</strong></summary>

| Usage  | Description |
|----------|-------------|
| nmap -sV     | Service scan (Service/version info) |
| nmap -sV -F  | Service scan + The most common 100 ports |
| nmap -sV --top-ports 100 | Service scan + Top **100** ports) |
| nmap -sV -A  | Service scan + Aggresive mode (Essential Scripts) |
| nmap -sV 192.168.1.0/24  | Service scan + All Devices on Network |
| nmap -sV -p- | Service scan + **65535 possible** ports |
| nmap -sV -p 80,443,8080  | Service scan + Specific Port Discovery |
| nmap -sV -A  -p- | Service scan + Aggresive Mode (Essential Scripts) + **65535 possible** ports |
| nmap -sV -T4 | Service scan + Fast and Light scan) |
| nmap -sV -O | Service scan + **OS** Detection) |
| nmap -sV -sC | Service scan + **Default Scripts** |
| nmap -sV -sU | Service scan + **UDP Scan**) |
| nmap -sV -T3 -oN scan_results.txt  | Service scan + Timing + Output direction) |
| nmap -sV --traceroute | Service scan + Traceroute utility) |

</details>

<details>
<summary><strong>üìå Live Host Discovery</strong></summary>


<div align="center">
  <img src="/assets/arp.png" style="height: 500px" alt="Background"/>
</div>


# üåê ARP        TCP/IP Link Layer üåê
---
- ARP scan usually requires privileged user to access because ARP requests and responses involve low-level network operations. 
- sudo nmap -PR -sn IP_ADDRESS/24
- **"-PR"** means that only ARP scans will be performed.
- **-sn** discover online hosts without live-port scanning.
## Arp Scan Tool
---
- Installation: *apt install arp-scan*
- *arp-scan* provides customization of your scan.
-  *--localnet* or *-l* -> sends ARP queries to all valid IP addresses on your local network.
- *-I* parameter usage when there is more than one *interface*
## Examples:
---
- sudo arp-scan -l/--localnet IP_ADDRESS/24
- sudo arp-scan -I eth0/tun0 -l IP_ADDRESS/24
- sudo arp-scan IP_ADDRESS/24
- **same approach:** sudo nmap -PR -sn IP_ADDRESS/24

# üåê ICMP       OSI Network Layer (5) üåê
---
- You can ping every ip addresses on network using:
  - Echo **Request**: **ping (ICMP Type 8/Echo)**
  - Echo **Respond**: **ping (ICMP Type 0)**

- *ICMP echo request* discovery: **nmap -PE -sn MACHINE_IP/24** 
  - This scan will send *ICMP echo packets* to every IP_ADDRESS on the subnet. 
  - **Notice:** Many firewalls block *ICMP*
  - **We may not expect to find MAC addresses on the scan results.**

- Method is not always *trustworthy*
  - Many firewalls block ICMP echo; new versions of MS Windows are configured with a host firewall that blocks ICMP echo requests by default.
  - If you are on the same subnet with target, *ARP* will perform scan instead of ICMP.

<div align="center">
  <img src="/assets/ICMP1.png" alt="Background"/>
</div>

## How can we decrease the chance being blocked by firewalls ?

### ICMP Timestamp Usage
---
- **ICMP Timestamp Request (Type 13)**
- **ICMP Timestamp Response (Type 14)**
- *nmap -PP -sn IP_ADDRESS/24* /24 will discover all the computers on the subnet.

#### General Information About ICMP Timestamp (Type 13/14)
---
- Used by a source host to request the current timestamp information from the destination host. 
- The source includes its own timestamp in the request packet.
- The destination host responds with an ICMP Timestamp Reply packet, which includes both the original timestamp from the request and the current timestamp from the destination host

<div align="center">
  <img src="/assets/ICMP2.png" alt="Background"/>
</div>

### ICMP Address Mask Usage
---
- **ICMP Address Mask Request (Type 17)**
- **ICMP Address Mask Response (Type 18)**
- *nmap -PM -sn IP_ADDRESS/24* will attempt to discover live hosts using ICMP Address Masking.

#### General Information About ICMP Address Mask (Type 17/18)
---
- Used for requesting the +subnet mask+ information of the target host.
- The recipient should respond with the appropriate subnet mask for that IP address.
- ICMP Address Mask Request messages are relatively **less** commonly used compared to other **ICMP types**.

<div align="center">
  <img src="/assets/ICMP3.png" alt="Background"/>
</div>

---
## SUMMARY:
- ICMP Host discover involves 3 types of scanning approach
  - ICMP echo request (Type 8/Echo)
  - ICMP echo response (Type 0)
  - ICMP Timestamp request (Type 13)
  - ICMP Timestamp response (Type 14)
  - ICMP Address Mask request (Type 17)
  - ICMP Address Mask response (Type 18)

# üåê TCP        OSI Transport Layer (4) üåê
# üåê UDP        OSI Transport Layer (4) üåê

</details>


## Extra Information on parameters

<details>
<summary><strong>üìå "-A" Parameter </strong></summary>

- Known as **Aggresive Mode**
- Fast Scan using **-T4** 
- Auto OS detection **-O**
- Service Detection **-sV**
- Pingless Scanning **-Pn**
- Most common *100* ports **-F**
- Traceroute between host and target **--traceroute**
- NSE Scripting utility **-sC**

</details>

<details>
<summary><strong>üìå "-Pn" Parameter </strong></summary>

- Bypassing the noisy **ICMP probes** that could trigger alerts.
- You can better assess your **Network's defenses**
- Enabling you to gather information **without alerting the defenders.**
- You can verify whether your security measures are effectively **blocking unauthorized access** attemps
- **Ethical Consideration**: Using -Pn without proper authorization can be seen as an aggressive action and might lead to unintended consequences.

</details>

<details>
<summary><strong>üìå Bypassing Firewall </strong></summary>

### TCP FIN, NULL, and Xmas Scans

These three scan types, exploit a subtle loophole in the TCP RFC(793) to differentiate between open and closed ports.
The key advantage to these scan types is that they can sneak through certain non-stateful firewalls and packet filtering routers.
Another advantage is that these scan types are a little more stealthy than even a SYN scan

### Null scan (-sN)

- Does not set any bits (TCP flag header is 0).

### FIN scan (-sF)

- Sets just the TCP FIN bit.

### Xmas scan (-sX)

- Sets the FIN, PSH, and URG flags, lighting the packet up like a Christmas tree.

| Probe Response | Assigned State |
|----------|-------------|
| No response received (even after retransmissions) | open|filtered |
| TCP RST packet | closed |
| ICMP unreachable error (type 3, code 1, 2, 3, 9, 10, or 13) | filtered|

</details>

